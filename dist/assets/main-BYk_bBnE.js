import"./modulepreload-polyfill-B5Qt9EMX.js";import{l as k,g as L,e as C,c as M,s as b}from"./favorites-Crj0hubu.js";import"https://www.gstatic.com/firebasejs/10.14.0/firebase-app.js";import"https://www.gstatic.com/firebasejs/10.14.0/firebase-auth.js";import"https://www.gstatic.com/firebasejs/10.14.0/firebase-firestore.js";function S(e,t){const r=document.getElementById("globalSearch"),a=document.getElementById("searchBtn");if(!r||!a){console.warn("üîç Search input or button not found in header.");return}const n=()=>{const o=r.value.trim().toLowerCase();if(!o){t(e);return}const s=e.filter(i=>{const l=i.title?.toLowerCase()||"",d=i.description?.toLowerCase()||"",m=i.year?.toString()||"",c=i.theme?.toLowerCase()||"";return l.includes(o)||d.includes(o)||m.includes(o)||c.includes(o)});t(s)};r.addEventListener("input",n),a.addEventListener("click",n)}function F(){const e=document.querySelectorAll(".event-card");if(!e.length)return;const t=new IntersectionObserver((r,a)=>{r.forEach(n=>{n.isIntersecting&&(n.target.classList.add("animate-in"),a.unobserve(n.target))})},{threshold:.2});e.forEach(r=>t.observe(r))}async function T(e="World History"){try{const t=`https://en.wikipedia.org/w/api.php?action=query&format=json&origin=*&prop=pageimages|extracts&exintro&explaintext&pithumbsize=500&generator=search&gsrsearch=${encodeURIComponent(e)}&gsrlimit=15`,a=await(await fetch(t)).json();return a.query?Object.values(a.query.pages).map((n,o)=>({id:n.pageid||o+1,title:n.title,description:n.extract?n.extract.slice(0,300):"No description available for this event.",image:n.thumbnail?.source||"./src/assets/placeholder.png",year:$(n.extract)||1900+o,theme:N(n.title+" "+n.extract),lat:null,lng:null})):[]}catch(t){return console.error("‚ùå fetchEvents failed:",t),[]}}function $(e=""){const t=e.match(/\b(1[5-9]\d{2}|20\d{2})\b/);return t?parseInt(t[0]):null}function N(e=""){return e=e.toLowerCase(),e.includes("war")?"war":e.includes("revolution")?"revolution":e.includes("flight")||e.includes("technology")||e.includes("invention")?"technology":e.includes("exploration")||e.includes("discovery")?"exploration":"general"}function g(e,t="info",r=3e3){try{const a="toast-container";let n=document.getElementById(a);n||(n=document.createElement("div"),n.id=a,n.style.position="fixed",n.style.right="1rem",n.style.top="1rem",n.style.zIndex=99999,n.style.display="flex",n.style.flexDirection="column",n.style.gap="8px",document.body.appendChild(n));const o=document.createElement("div");o.className=`toast toast-${t}`,o.textContent=e,o.style.padding="10px 14px",o.style.borderRadius="8px",o.style.boxShadow="0 6px 20px rgba(0,0,0,0.12)",o.style.maxWidth="360px",o.style.fontSize="0.95rem",o.style.opacity="0",o.style.transform="translateY(-6px)",o.style.transition="opacity .18s, transform .18s",t==="success"?(o.style.background="#ecfdf5",o.style.color="#065f46"):t==="error"?(o.style.background="#fff1f2",o.style.color="#7f1d1d"):(o.style.background="#f3f4f6",o.style.color="#111827"),n.appendChild(o),requestAnimationFrame(()=>{o.style.opacity="1",o.style.transform="translateY(0)"}),setTimeout(()=>{o.style.opacity="0",o.style.transform="translateY(-6px)",setTimeout(()=>o.remove(),220)},r)}catch(a){console.warn("toast error",a)}}function A(e,t=1e4){return new Promise((r,a)=>{if(window.google&&window.google.maps&&window.google.maps.importLibrary){r(window.google);return}const n=document.querySelector("script[data-google-maps-loader]");if(n){n.addEventListener("load",()=>{window.google?r(window.google):a(new Error("Google loaded but window.google missing"))}),n.addEventListener("error",a);return}const o="_gmaps_loader_callback_"+Date.now();window[o]=()=>{delete window[o],r(window.google)};const s=document.createElement("script");s.dataset.googleMapsLoader="1",s.src=`https://maps.googleapis.com/maps/api/js?key=${encodeURIComponent(e)}&callback=${o}&libraries=maps,marker`,s.async=!0,s.defer=!0,s.onerror=i=>{delete window[o],a(i)},document.head.appendChild(s),setTimeout(()=>{window.google||a(new Error("Google Maps load timeout"))},t)})}const I="AIzaSyDLwMRu47yXHBbfX4cimCx9BnIEtdmd0zk";let f=[];async function B(e,t){const r=document.getElementById(t);if(!r)return;const a=await fetch(e);r.innerHTML=await a.text()}function h(e=[]){const t=document.getElementById("timelineList");if(t){if(!e||e.length===0){t.innerHTML='<p class="no-results">No events found for your search.</p>';return}t.innerHTML=e.map(r=>`
    <div class="event-card" data-id="${r.id}">
      <img src="${r.image}" alt="${r.title}" class="event-image">
      <div class="card-body">
        <h3>${r.title}</h3>
        <p>${(r.description||"").slice(0,100)}...</p>
      </div>
      <button class="favorite-btn" title="Favorite">‚ù§Ô∏è</button>
    </div>
  `).join(""),F()}}async function x(){const e=await L(),t=document.getElementById("favoritesList");if(!t)return;t.innerHTML=`
    <div class="favorites-header">
      <h3>Your Favorites</h3>
      <div class="fav-actions">
        <button id="exportFavsBtn" class="btn-small">‚¨áÔ∏è Export</button>
        <button id="shareFavsBtn" class="btn-small">üîó Share</button>
      </div>
    </div>
    ${e.length?e.map(n=>`
      <div class="event-card small" data-id="${n.id}">
        <img src="${n.image}" alt="${n.title}" class="event-image-small">
        <div class="card-body"><h4>${n.title}</h4></div>
      </div>
    `).join(""):"<p>No favorites yet ‚ù§Ô∏è</p>"}
  `;const r=document.getElementById("exportFavsBtn"),a=document.getElementById("shareFavsBtn");r&&(r.onclick=C),a&&(a.onclick=async()=>{await M(),g("‚úÖ Share link copied to clipboard!","success")})}async function y(e){const t=document.getElementById("eventModal");if(!t||!e)return;const r=document.getElementById("modalTitle"),a=document.getElementById("modalImage"),n=document.getElementById("modalDescription"),o=document.getElementById("modalMap"),s=document.getElementById("modalFooter");r.textContent=e.title||"",a.src=e.image||"./src/assets/placeholder.png",n.textContent=e.description||"No description available.",o.innerHTML="Loading map...",s&&(s.innerHTML=""),t.style.display="block";try{await A(I);const{Map:i}=await google.maps.importLibrary("maps"),{AdvancedMarkerElement:l}=await google.maps.importLibrary("marker");let d=e.lat,m=e.lng;if(!d||!m)try{const u=await(await fetch(`https://maps.googleapis.com/maps/api/geocode/json?address=${encodeURIComponent(e.title)}&key=${I}`)).json();if(u.status==="OK"&&u.results&&u.results[0]){const p=u.results[0].geometry.location;d=p.lat,m=p.lng;const E=JSON.parse(localStorage.getItem("coordsCache")||"{}");E[e.title]={lat:d,lng:m},localStorage.setItem("coordsCache",JSON.stringify(E))}}catch(c){console.warn("Geocode fallback failed",c)}if(d&&m){const c={lat:Number(d),lng:Number(m)},u=new i(o,{zoom:5,center:c});new l({map:u,position:c,title:e.title});const p=document.createElement("a");p.href=`https://www.google.com/maps?q=${c.lat},${c.lng}`,p.target="_blank",p.rel="noopener",p.textContent="üìç View on Google Maps",p.style.display="inline-block",p.style.marginTop="8px",o.appendChild(p)}else o.innerHTML="<p>Location not available.</p>"}catch(i){console.error("Map render failed",i),o.innerHTML="<p>Map could not be loaded.</p>"}if(s){s.innerHTML='<button id="shareEventBtn" class="btn-small">üîó Share this event</button>';const i=document.getElementById("shareEventBtn");i&&(i.onclick=()=>{try{const l=btoa(unescape(encodeURIComponent(JSON.stringify(e)))),d=`${location.origin}${location.pathname}?event=${l}`;navigator.clipboard.writeText(d),g("‚úÖ Event link copied to clipboard!","success")}catch{g("Failed to create share link","error")}})}}function w(e){const t=((e.title||"")+" "+(e.description||"")).toLowerCase();return t.includes("war")?"war":t.includes("revolution")?"revolution":t.includes("flight")||t.includes("moon")||t.includes("internet")||t.includes("industrial")?"technology":t.includes("discovery")||t.includes("exploration")?"exploration":"general"}function H(e){const t=document.getElementById("filterYear"),r=document.getElementById("filterDecade"),a=document.getElementById("filterTheme");if(!t||!r||!a)return;t.innerHTML='<option value="all">All years</option>',r.innerHTML='<option value="all">All decades</option>',a.innerHTML='<option value="all">All themes</option>',[...new Set(e.map(i=>i.year).filter(Boolean))].sort((i,l)=>i-l).forEach(i=>{const l=document.createElement("option");l.value=i,l.textContent=i,t.appendChild(l)}),[...new Set(e.map(i=>Math.floor(i.year/10)*10).filter(i=>Number.isFinite(i)))].sort((i,l)=>i-l).forEach(i=>{const l=document.createElement("option");l.value=i,l.textContent=`${i}s`,r.appendChild(l)}),[...new Set(e.map(i=>i.theme||w(i)))].forEach(i=>{const l=document.createElement("option");l.value=i,l.textContent=i.charAt(0).toUpperCase()+i.slice(1),a.appendChild(l)})}function v(){const e=document.getElementById("filterYear")?.value||"all",t=document.getElementById("filterDecade")?.value||"all",r=document.getElementById("filterTheme")?.value||"all";let a=[...f];if(e!=="all")a=a.filter(n=>n.year==e);else if(t!=="all"){const n=Number(t);a=a.filter(o=>o.year>=n&&o.year<n+10)}r!=="all"&&(a=a.filter(n=>(n.theme||w(n))===r)),h(a)}async function R(e){try{const t=await L();if(t.find(a=>a&&a.id===e.id)){const a=t.filter(n=>n&&n.id!==e.id);await b(a),g("Removed from favorites ‚ùå","error")}else t.push(e),await b(t),g("Added to favorites ‚ù§Ô∏è","success");await x()}catch(t){console.error("toggleFavorite error",t),g("Failed toggling favorite","error")}}function U(){const e=new URLSearchParams(location.search);if(!e.has("event"))return null;try{const t=decodeURIComponent(escape(atob(e.get("event"))));return JSON.parse(t)}catch(t){return console.warn("Failed parsing shared event",t),null}}document.addEventListener("DOMContentLoaded",async()=>{await B("./src/partials/header.html","header-placeholder"),await B("./src/partials/footer.html","footer-placeholder"),k();try{let e=await T("World History");(!e||e.length===0)&&(e=await(await fetch("./data/events.json")).json()),e.forEach(l=>{l.theme||(l.theme=w(l))}),f=[...[{id:9991,title:"Moon landing",description:"Apollo 11 (1969).",image:"https://upload.wikimedia.org/wikipedia/commons/9/9c/Aldrin_Apollo_11.jpg",year:1969,lat:.67408,lng:23.47297,theme:"technology"},{id:9992,title:"French Revolution",description:"1789 - 1799.",image:"https://upload.wikimedia.org/wikipedia/commons/6/6f/Prise_de_la_Bastille.jpg",year:1789,lat:48.8566,lng:2.3522,theme:"revolution"}],...e],h(f),await x(),H(f),document.getElementById("filterYear")?.addEventListener("change",v),document.getElementById("filterDecade")?.addEventListener("change",v),document.getElementById("filterTheme")?.addEventListener("change",v);const r=document.getElementById("clearFiltersBtn");r&&r.addEventListener("click",()=>{document.getElementById("filterYear").value="all",document.getElementById("filterDecade").value="all",document.getElementById("filterTheme").value="all",h(f)});const a=document.getElementById("timelineList"),n=document.getElementById("favoritesList"),o=document.getElementById("eventModal"),s=document.getElementById("closeModal");a&&a.addEventListener("click",async l=>{const d=l.target.closest(".event-card");if(!d)return;const m=Number(d.dataset.id),c=f.find(u=>Number(u.id)===m);c&&(l.target.classList.contains("favorite-btn")?await R(c):y(c))}),n&&n.addEventListener("click",l=>{const d=l.target.closest(".event-card");if(!d)return;const m=Number(d.dataset.id),c=f.find(u=>Number(u.id)===m);c&&y(c)}),s&&s.addEventListener("click",()=>o.style.display="none");const i=U();i&&y(i),S(f,h)}catch(e){console.error("main load error",e),g("Failed to load events. See console.","error")}});

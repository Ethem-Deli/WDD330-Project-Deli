import"./modulepreload-polyfill-B5Qt9EMX.js";import{a as L,l as I,g as f,s as v,e as k,c as B,m as M}from"./favorites-JPAmtfbB.js";import{onAuthStateChanged as S}from"https://www.gstatic.com/firebasejs/10.14.0/firebase-auth.js";import"https://www.gstatic.com/firebasejs/10.14.0/firebase-app.js";import"https://www.gstatic.com/firebasejs/10.14.0/firebase-firestore.js";function F(t,n){const e=document.getElementById("globalSearch"),o=document.getElementById("searchBtn");if(!e||!o){console.warn("üîç Search input or button not found in header.");return}const a=()=>{const i=e.value.trim().toLowerCase();if(!i){n(t);return}const c=t.filter(r=>{const l=r.title?.toLowerCase()||"",d=r.description?.toLowerCase()||"",s=r.year?.toString()||"",m=r.theme?.toLowerCase()||"";return l.includes(i)||d.includes(i)||s.includes(i)||m.includes(i)});n(c)};e.addEventListener("input",a),o.addEventListener("click",a)}function x(){const t=document.querySelectorAll(".event-card");if(!t.length)return;const n=new IntersectionObserver((e,o)=>{e.forEach(a=>{a.isIntersecting&&(a.target.classList.add("animate-in"),o.unobserve(a.target))})},{threshold:.2});t.forEach(e=>n.observe(e))}const C="https://en.wikipedia.org/w/api.php";async function b(t){const n=new URL(C);t.format="json",t.origin="*",Object.keys(t).forEach(o=>n.searchParams.append(o,t[o]));const e=await fetch(n.toString());if(!e.ok)throw new Error(`Wikipedia API error: ${e.status}`);return e.json()}async function $(t,n=10){if(!t.trim())return[];const e=await b({action:"query",list:"search",srsearch:t,srlimit:String(n),srprop:"snippet|timestamp"});return!e.query||!e.query.search?[]:e.query.search.map(o=>({id:o.pageid,title:o.title,snippet:(o.snippet||"").replace(/<\/?[^>]+(>|$)/g,"")}))}async function T(t=[]){if(!t.length)return{};const n={action:"query",pageids:t.join("|"),prop:"coordinates|pageimages|extracts",piprop:"thumbnail",pithumbsize:"600",exintro:"1",explaintext:"1"},e=await b(n),o={};if(!e.query||!e.query.pages)return o;for(const a of Object.keys(e.query.pages)){const i=e.query.pages[a];o[a]={pageid:i.pageid,title:i.title,thumbnail:i.thumbnail?i.thumbnail.source:null,extract:i.extract||"",coordinates:i.coordinates&&i.coordinates[0]?{lat:i.coordinates[0].lat,lon:i.coordinates[0].lon}:null}}return o}async function A(t){try{const n=await $(t,12);if(!n.length)return[];const e=n.map(a=>a.id),o=await T(e);return n.map(a=>{const i=String(a.id),c=o[i]||{};return{id:a.id,pageid:a.id,title:a.title,description:c.extract||a.snippet||"",image:c.thumbnail||"./src/assets/logo.png",lat:c.coordinates?c.coordinates.lat:null,lng:c.coordinates?c.coordinates.lon:null}})}catch(n){return console.error("fetchEvents error",n),[]}}function u(t,n="info"){let e=document.querySelector(".toast-container");e||(e=document.createElement("div"),e.className="toast-container",document.body.appendChild(e));const o=document.createElement("div");o.className=`toast toast-${n}`,o.textContent=t,e.appendChild(o),setTimeout(()=>o.classList.add("visible"),50),setTimeout(()=>{o.classList.remove("visible"),setTimeout(()=>o.remove(),400)},3e3)}function q(t){S(L,n=>t(n))}let p=[];async function j(t){if(!(window.google&&google.maps))return new Promise((n,e)=>{const o=document.querySelector("script[data-google-maps]");if(o){o.onload=n,o.onerror=e;return}const a=document.createElement("script");a.dataset.googleMaps="true",a.src=`https://maps.googleapis.com/maps/api/js?key=${t}&loading=async&libraries=maps,marker`,a.async=!0,a.defer=!0,a.onload=n,a.onerror=e,document.head.appendChild(a)})}async function y(t,n){const e=document.getElementById(n);if(!e)return;const o=await fetch(t);e.innerHTML=await o.text()}function w(t=[]){const n=document.getElementById("timelineList");if(n){if(!t||t.length===0){n.innerHTML='<p class="no-results">No events found for your search.</p>';return}n.innerHTML=t.map(e=>`
      <div class="event-card" data-id="${e.id}">
        <img src="${e.image}" alt="${e.title}" class="event-image">
        <div class="card-body">
          <h3>${e.title}</h3>
          <p>${e.description.slice(0,100)}...</p>
        </div>
        <button class="favorite-btn" title="Favorite">‚ù§Ô∏è</button>
      </div>
    `).join(""),x()}}function E(t=[]){const n=document.getElementById("favoritesList");n&&(n.innerHTML=`
    <div class="favorites-header">
      <h3>Your Favorites</h3>
      <div class="fav-actions">
        <button id="exportFavsBtn" class="btn-small">‚¨áÔ∏è Export</button>
        <button id="shareFavsBtn" class="btn-small">üîó Share</button>
      </div>
    </div>
    ${t.length?t.map(e=>`
              <div class="event-card small" data-id="${e.id}">
                <img src="${e.image}" alt="${e.title}" class="event-image-small">
                <div class="card-body"><h4>${e.title}</h4></div>
              </div>`).join(""):"<p>No favorites yet ‚ù§Ô∏è</p>"}
  `,document.getElementById("exportFavsBtn").onclick=k,document.getElementById("shareFavsBtn").onclick=async()=>{await B(),u("‚úÖ Share link copied to clipboard!","success")})}async function H(t){const n=await f();if(n.find(o=>o.id===t.id)){const o=n.filter(a=>a.id!==t.id);await v(o),u("Removed from favorites ‚ùå","error")}else n.push(t),await v(n),u("Added to favorites ‚ù§Ô∏è","success");E(await f())}async function h(t){const n=document.getElementById("eventModal"),e=document.getElementById("modalTitle"),o=document.getElementById("modalImage"),a=document.getElementById("modalDescription"),i=document.getElementById("modalMap"),c=document.getElementById("modalFooter");if(n){n.style.display="block",e.textContent=t.title,o.src=t.image||"./src/assets/placeholder.png",a.textContent=t.description||"No description available.",i.innerHTML="Loading map...",await j("AIzaSyDLwMRu47yXHBbfX4cimCx9BnIEtdmd0zk");try{const{Map:r}=await google.maps.importLibrary("maps"),{AdvancedMarkerElement:l}=await google.maps.importLibrary("marker"),d=t.lat,s=t.lng;if(d&&s){const m=new r(i,{zoom:5,center:{lat:d,lng:s}});new l({map:m,position:{lat:d,lng:s},title:t.title});const g=document.createElement("a");g.href=`https://www.google.com/maps?q=${d},${s}`,g.target="_blank",g.textContent="üìç View on Google Maps",i.appendChild(g)}else i.innerHTML="<p>Location not available.</p>"}catch(r){console.error("Map error:",r),i.innerHTML="<p>Map could not be loaded.</p>"}c.innerHTML=`
    <button id="shareEventBtn" class="btn-small">üîó Share this event</button>
  `,document.getElementById("shareEventBtn").onclick=()=>{const r=btoa(unescape(encodeURIComponent(JSON.stringify(t)))),l=`${location.origin}${location.pathname}?event=${r}`;navigator.clipboard.writeText(l).then(()=>{u("‚úÖ Event link copied to clipboard!","success")})}}}function P(){const t=new URLSearchParams(location.search);if(!t.has("event"))return null;try{const n=decodeURIComponent(escape(atob(t.get("event"))));return JSON.parse(n)}catch(n){return console.error("‚ùå Failed to parse shared event:",n),null}}document.addEventListener("DOMContentLoaded",async()=>{await y("./src/partials/header.html","header-placeholder"),await y("./src/partials/footer.html","footer-placeholder"),await I(),q(async t=>{t&&await M(),E(await f())});try{let t=await A("World History");t.length||(t=await(await fetch("./data/events.json")).json()),p=[...[{id:9991,title:"Moon landing",description:"Apollo 11 was the first manned Moon landing in 1969.",image:"https://upload.wikimedia.org/wikipedia/commons/9/9c/Aldrin_Apollo_11.jpg",lat:.67408,lng:23.47297},{id:9992,title:"French Revolution",description:"A major political upheaval in France (1789‚Äì1799).",image:"https://upload.wikimedia.org/wikipedia/commons/6/6f/Prise_de_la_Bastille.jpg",lat:48.8566,lng:2.3522}],...t],w(p);const e=P();e&&h(e),F(p,w);const o=document.getElementById("timelineList"),a=document.getElementById("favoritesList"),i=document.getElementById("eventModal"),c=document.getElementById("closeModal");o.addEventListener("click",async r=>{const l=r.target.closest(".event-card");if(!l)return;const d=+l.dataset.id,s=p.find(m=>m.id===d);s&&(r.target.classList.contains("favorite-btn")?await H(s):h(s))}),a.addEventListener("click",r=>{const l=r.target.closest(".event-card");if(!l)return;const d=+l.dataset.id,s=p.find(m=>m.id===d);s&&h(s)}),c.addEventListener("click",()=>i.style.display="none")}catch(t){console.error("Error:",t),u("Failed to load events.","error")}});window.initMap=()=>{console.log("‚úÖ Google Maps API initialized.")};

import{initializeApp as m}from"https://www.gstatic.com/firebasejs/10.14.0/firebase-app.js";import{getAuth as g}from"https://www.gstatic.com/firebasejs/10.14.0/firebase-auth.js";import{getFirestore as h,setDoc as v,getDoc as y,doc as F}from"https://www.gstatic.com/firebasejs/10.14.0/firebase-firestore.js";const w={apiKey:"AIzaSyB92OXlJn50jta9IHuY5czC937HMgYH2xs",authDomain:"historytimeline-wdd330.firebaseapp.com",projectId:"historytimeline-wdd330",storageBucket:"historytimeline-wdd330.firebasestorage.app",messagingSenderId:"539673015003",appId:"1:539673015003:web:2621f434393950b78312fe",measurementId:"G-GV6LHVLN1R"},f=m(w),s=g(f),b=h(f),n="favorites";function a(){try{return JSON.parse(localStorage.getItem(n)||"[]")}catch{return[]}}function d(e){localStorage.setItem(n,JSON.stringify(e||[]))}function u(e){return F(b,"users",e)}async function i(){const e=s.currentUser;if(!e)return a();try{const r=u(e.uid),t=await y(r);return t.exists()?t.data().favorites||[]:[]}catch(r){return console.error("❌ Failed to load favorites from Firestore:",r),a()}}async function p(e=[]){const r=s.currentUser;if(!r){d(e);return}try{const t=u(r.uid);await v(t,{favorites:e},{merge:!0})}catch(t){console.error("❌ Failed to save favorites to Firestore:",t),d(e)}}async function L(){const e=a();if(!(!e?.length||!s.currentUser))try{const o=[...await i()];for(const c of e)o.find(l=>l&&l.id===c.id)||o.push(c);await p(o),localStorage.removeItem(n)}catch(t){console.error("❌ Failed to merge local favorites:",t)}}async function O(){const e=await i(),r=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),t=URL.createObjectURL(r),o=document.createElement("a");o.href=t,o.download="favorites-timeline.json",o.click(),URL.revokeObjectURL(t)}async function R(){const e=await i(),r=btoa(unescape(encodeURIComponent(JSON.stringify(e)))),t=`${location.origin}${location.pathname}?shared=${r}`;await navigator.clipboard.writeText(t),alert("✅ Share link copied to clipboard!")}async function C(){const e=new URLSearchParams(location.search);if(e.has("shared"))try{const r=decodeURIComponent(escape(atob(e.get("shared")))),t=JSON.parse(r);await p(t),alert("✅ Imported shared favorites!")}catch(r){console.error("❌ Failed to import shared favorites:",r)}}export{s as a,R as c,O as e,i as g,C as l,L as m,p as s};

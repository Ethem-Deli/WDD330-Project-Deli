import"./modulepreload-polyfill-B5Qt9EMX.js";import{l as M,g as k,e as C,c as F,s as L}from"./favorites-J_X_7SHO.js";import"https://www.gstatic.com/firebasejs/10.14.0/firebase-app.js";import"https://www.gstatic.com/firebasejs/10.14.0/firebase-auth.js";import"https://www.gstatic.com/firebasejs/10.14.0/firebase-firestore.js";function T(e,t){const a=document.getElementById("globalSearch"),r=document.getElementById("searchBtn");if(!a||!r){console.warn("üîç Search input or button not found in header.");return}const n=()=>{const o=a.value.trim().toLowerCase();if(!o){t(e);return}const c=e.filter(i=>{const s=i.title?.toLowerCase()||"",u=i.description?.toLowerCase()||"",p=i.year?.toString()||"",l=i.theme?.toLowerCase()||"";return s.includes(o)||u.includes(o)||p.includes(o)||l.includes(o)});t(c)};a.addEventListener("input",n),r.addEventListener("click",n)}function S(){const e=document.querySelectorAll(".event-card");if(!e.length)return;const t=new IntersectionObserver((a,r)=>{a.forEach(n=>{n.isIntersecting&&(n.target.classList.add("animate-in"),r.unobserve(n.target))})},{threshold:.2});e.forEach(a=>t.observe(a))}async function $(e="World History"){try{const t=`https://en.wikipedia.org/w/api.php?action=query&format=json&origin=*&prop=pageimages|extracts&exintro&explaintext&pithumbsize=500&generator=search&gsrsearch=${encodeURIComponent(e)}&gsrlimit=15`,r=await(await fetch(t)).json();return r.query?Object.values(r.query.pages).map((n,o)=>({id:n.pageid||o+1,title:n.title,description:n.extract?n.extract.slice(0,300):"No description available for this event.",image:n.thumbnail?.source||"./src/assets/placeholder.png",year:A(n.extract)||1900+o,theme:N(n.title+" "+n.extract),lat:null,lng:null})):[]}catch(t){return console.error("‚ùå fetchEvents failed:",t),[]}}function A(e=""){const t=e.match(/\b(1[5-9]\d{2}|20\d{2})\b/);return t?parseInt(t[0]):null}function N(e=""){return e=e.toLowerCase(),e.includes("war")?"war":e.includes("revolution")?"revolution":e.includes("flight")||e.includes("technology")||e.includes("invention")?"technology":e.includes("exploration")||e.includes("discovery")?"exploration":"general"}function f(e,t="info",a=3e3){try{const r="toast-container";let n=document.getElementById(r);n||(n=document.createElement("div"),n.id=r,n.style.position="fixed",n.style.right="1rem",n.style.top="1rem",n.style.zIndex=99999,n.style.display="flex",n.style.flexDirection="column",n.style.gap="8px",document.body.appendChild(n));const o=document.createElement("div");o.className=`toast toast-${t}`,o.textContent=e,o.style.padding="10px 14px",o.style.borderRadius="8px",o.style.boxShadow="0 6px 20px rgba(0,0,0,0.12)",o.style.maxWidth="360px",o.style.fontSize="0.95rem",o.style.opacity="0",o.style.transform="translateY(-6px)",o.style.transition="opacity .18s, transform .18s",t==="success"?(o.style.background="#ecfdf5",o.style.color="#065f46"):t==="error"?(o.style.background="#fff1f2",o.style.color="#7f1d1d"):(o.style.background="#f3f4f6",o.style.color="#111827"),n.appendChild(o),requestAnimationFrame(()=>{o.style.opacity="1",o.style.transform="translateY(0)"}),setTimeout(()=>{o.style.opacity="0",o.style.transform="translateY(-6px)",setTimeout(()=>o.remove(),220)},a)}catch(r){console.warn("toast error",r)}}function H(e,t=1e4){return new Promise((a,r)=>{if(window.google&&window.google.maps&&window.google.maps.importLibrary){a(window.google);return}const n=document.querySelector("script[data-google-maps-loader]");if(n){n.addEventListener("load",()=>{window.google?a(window.google):r(new Error("Google loaded but window.google missing"))}),n.addEventListener("error",r);return}const o="_gmaps_loader_callback_"+Date.now();window[o]=()=>{delete window[o],a(window.google)};const c=document.createElement("script");c.dataset.googleMapsLoader="1",c.src=`https://maps.googleapis.com/maps/api/js?key=${encodeURIComponent(e)}&callback=${o}&libraries=maps,marker`,c.async=!0,c.defer=!0,c.onerror=i=>{delete window[o],r(i)},document.head.appendChild(c),setTimeout(()=>{window.google||r(new Error("Google Maps load timeout"))},t)})}function R(){const e=document.getElementById("hamburgerBtn"),t=document.getElementById("navMenu");!e||!t||(e.addEventListener("click",a=>{a.stopPropagation(),t.classList.toggle("open"),e.classList.toggle("active")}),t.querySelectorAll("a").forEach(a=>{a.addEventListener("click",()=>{t.classList.remove("open"),e.classList.remove("active")})}),document.addEventListener("click",a=>{!t.contains(a.target)&&!e.contains(a.target)&&(t.classList.remove("open"),e.classList.remove("active"))}))}document.addEventListener("DOMContentLoaded",()=>{R()});const B="AIzaSyDLwMRu47yXHBbfX4cimCx9BnIEtdmd0zk";let g=[];async function I(e,t){const a=document.getElementById(t);if(!a)return;const r=await fetch(e);a.innerHTML=await r.text()}function y(e=[]){const t=document.getElementById("timelineList");if(t){if(!e||e.length===0){t.innerHTML='<p class="no-results">No events found for your search.</p>';return}t.innerHTML=e.map(a=>`
      <div class="event-card" data-id="${a.id}">
        <img src="${a.image}" alt="${a.title}" class="event-image">
        <div class="card-body">
          <h3>${a.title}</h3>
          <p>${(a.description||"").slice(0,100)}...</p>
        </div>
        <button class="favorite-btn" title="Favorite">‚ù§Ô∏è</button>
      </div>`).join(""),S()}}async function x(){const e=await k(),t=document.getElementById("favoritesList");if(!t)return;t.innerHTML=`
    <div class="favorites-header">
      <h3>Your Favorites</h3>
      <div class="fav-actions">
        <button id="exportFavsBtn" class="btn-small">‚¨áÔ∏è Export</button>
        <button id="shareFavsBtn" class="btn-small">üîó Share</button>
      </div>
    </div>
    ${e.length?e.map(n=>`
              <div class="event-card small" data-id="${n.id}">
                <img src="${n.image}" alt="${n.title}" class="event-image-small">
                <div class="card-body"><h4>${n.title}</h4></div>
              </div>`).join(""):"<p>No favorites yet ‚ù§Ô∏è</p>"}
  `;const a=document.getElementById("exportFavsBtn"),r=document.getElementById("shareFavsBtn");a&&(a.onclick=C),r&&(r.onclick=async()=>{await F(),f("‚úÖ Share link copied to clipboard!","success")})}async function w(e){const t=document.getElementById("eventModal");if(!t||!e)return;const a=document.getElementById("modalTitle"),r=document.getElementById("modalImage"),n=document.getElementById("modalDescription"),o=document.getElementById("modalMap"),c=document.getElementById("modalFooter");a.textContent=e.title||"",r.src=e.image||"./src/assets/placeholder.png",n.textContent=e.description||"No description available.",o.innerHTML="Loading map...",c&&(c.innerHTML=""),t.style.display="block";try{await H(B);const{Map:i}=await google.maps.importLibrary("maps"),{AdvancedMarkerElement:s}=await google.maps.importLibrary("marker");let{lat:u,lng:p}=e;if(!u||!p)try{const m=await(await fetch(`https://maps.googleapis.com/maps/api/geocode/json?address=${encodeURIComponent(e.title)}&key=${B}`)).json();if(m.status==="OK"&&m.results?.[0]){const d=m.results[0].geometry.location;u=d.lat,p=d.lng}}catch(l){console.warn("Geocode fallback failed",l)}if(u&&p){const l={lat:Number(u),lng:Number(p)},m=new i(o,{zoom:5,center:l});new s({map:m,position:l,title:e.title});const d=document.createElement("a");d.href=`https://www.google.com/maps?q=${l.lat},${l.lng}`,d.target="_blank",d.rel="noopener",d.textContent="üìç View on Google Maps",d.style.display="inline-block",d.style.marginTop="8px",o.appendChild(d)}else o.innerHTML="<p>Location not available.</p>"}catch(i){console.error("Map render failed",i),o.innerHTML="<p>Map could not be loaded.</p>"}if(c){c.innerHTML='<button id="shareEventBtn" class="btn-small">üîó Share this event</button>';const i=document.getElementById("shareEventBtn");i&&(i.onclick=()=>{try{const s=btoa(unescape(encodeURIComponent(JSON.stringify(e)))),u=`${location.origin}${location.pathname}?event=${s}`;navigator.clipboard.writeText(u),f("‚úÖ Event link copied to clipboard!","success")}catch{f("Failed to create share link","error")}})}}function b(e){const t=((e.title||"")+" "+(e.description||"")).toLowerCase();return t.includes("war")?"war":t.includes("revolution")?"revolution":t.includes("flight")||t.includes("moon")||t.includes("internet")||t.includes("industrial")?"technology":t.includes("discovery")||t.includes("exploration")?"exploration":"general"}function U(e){const t=document.getElementById("filterYear"),a=document.getElementById("filterDecade"),r=document.getElementById("filterTheme");if(!t||!a||!r)return;t.innerHTML='<option value="all">All years</option>',a.innerHTML='<option value="all">All decades</option>',r.innerHTML='<option value="all">All themes</option>',[...new Set(e.map(i=>i.year).filter(Boolean))].sort((i,s)=>i-s).forEach(i=>{const s=document.createElement("option");s.value=i,s.textContent=i,t.appendChild(s)}),[...new Set(e.map(i=>Math.floor(i.year/10)*10).filter(i=>Number.isFinite(i)))].sort((i,s)=>i-s).forEach(i=>{const s=document.createElement("option");s.value=i,s.textContent=`${i}s`,a.appendChild(s)}),[...new Set(e.map(i=>i.theme||b(i)))].forEach(i=>{const s=document.createElement("option");s.value=i,s.textContent=i.charAt(0).toUpperCase()+i.slice(1),r.appendChild(s)})}function E(){const e=document.getElementById("filterYear")?.value||"all",t=document.getElementById("filterDecade")?.value||"all",a=document.getElementById("filterTheme")?.value||"all";let r=[...g];if(e!=="all")r=r.filter(n=>n.year==e);else if(t!=="all"){const n=Number(t);r=r.filter(o=>o.year>=n&&o.year<n+10)}a!=="all"&&(r=r.filter(n=>(n.theme||b(n))===a)),y(r)}async function _(e){try{const t=await k();if(t.find(r=>r&&r.id===e.id)){const r=t.filter(n=>n&&n.id!==e.id);await L(r),f("Removed from favorites ‚ùå","error")}else t.push(e),await L(t),f("Added to favorites ‚ù§Ô∏è","success");await x()}catch(t){console.error("toggleFavorite error",t),f("Failed toggling favorite","error")}}function Y(){const e=new URLSearchParams(location.search);if(!e.has("event"))return null;try{const t=decodeURIComponent(escape(atob(e.get("event"))));return JSON.parse(t)}catch(t){return console.warn("Failed parsing shared event",t),null}}document.addEventListener("DOMContentLoaded",async()=>{await I("./src/partials/header.html","header-placeholder"),await I("./src/partials/footer.html","footer-placeholder"),M();try{const t=await(await fetch("./data/events.json")).json();let a=[];try{a=await $("World History")}catch(l){console.warn("API fetch failed:",l)}const r=[...t.slice(0,10),...a.slice(0,10)];g=[...[{id:9991,title:"Moon Landing",description:"Apollo 11 (1969).",image:"https://upload.wikimedia.org/wikipedia/commons/9/9c/Aldrin_Apollo_11.jpg",year:1969,lat:.67408,lng:23.47297,theme:"technology"},{id:9992,title:"French Revolution",description:"1789 - 1799.",image:"https://upload.wikimedia.org/wikipedia/commons/6/6f/Prise_de_la_Bastille.jpg",year:1789,lat:48.8566,lng:2.3522,theme:"revolution"}],...r].map((l,m)=>({id:l.id||m+1,title:l.title||"Untitled Event",description:l.description||"No description available.",image:l.image||"./src/assets/placeholder.png",year:l.year||null,lat:l.lat||null,lng:l.lng||null,theme:l.theme||b(l)})),y(g),await x(),U(g),document.getElementById("filterYear")?.addEventListener("change",E),document.getElementById("filterDecade")?.addEventListener("change",E),document.getElementById("filterTheme")?.addEventListener("change",E);const o=document.getElementById("clearFiltersBtn");o&&o.addEventListener("click",()=>{document.getElementById("filterYear").value="all",document.getElementById("filterDecade").value="all",document.getElementById("filterTheme").value="all",y(g)});const c=document.getElementById("timelineList"),i=document.getElementById("favoritesList"),s=document.getElementById("eventModal"),u=document.getElementById("closeModal");c&&c.addEventListener("click",async l=>{const m=l.target.closest(".event-card");if(!m)return;const d=Number(m.dataset.id),h=g.find(v=>Number(v.id)===d);h&&(l.target.classList.contains("favorite-btn")?await _(h):w(h))}),i&&i.addEventListener("click",l=>{const m=l.target.closest(".event-card");if(!m)return;const d=Number(m.dataset.id),h=g.find(v=>Number(v.id)===d);h&&w(h)}),u&&u.addEventListener("click",()=>s.style.display="none");const p=Y();p&&w(p),T(g,y)}catch(e){console.error("main load error",e),f("Failed to load events. See console.","error")}});

import{initializeApp as f}from"https://www.gstatic.com/firebasejs/10.14.0/firebase-app.js";import{getAuth as h,onAuthStateChanged as c,signInWithEmailAndPassword as w,createUserWithEmailAndPassword as p}from"https://www.gstatic.com/firebasejs/10.14.0/firebase-auth.js";const y={apiKey:"AIzaSyB92OXlJn50jta9IHuY5czC937HMgYH2xs",authDomain:"historytimeline-wdd330.firebaseapp.com",projectId:"historytimeline-wdd330",storageBucket:"historytimeline-wdd330.firebasestorage.app",messagingSenderId:"539673015003",appId:"1:539673015003:web:2621f434393950b78312fe",measurementId:"G-GV6LHVLN1R"},v=f(y),i=h(v);function b(e,t){return w(i,e,t)}function B(e,t){return p(i,e,t)}function L(e){c(i,t=>{e(t)})}function A(e="login.html"){c(i,t=>{t||(alert("Please log in to access this page."),window.location.href=e)})}function d(){return"local_users_v1"}function m(){try{return JSON.parse(localStorage.getItem(d())||"[]")}catch{return[]}}function I(e){localStorage.setItem(d(),JSON.stringify(e))}async function u(e,t){try{const r=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),a=await r.json();if(!r.ok)throw new Error(a.message||"Server error");return a}catch(r){return console.warn("Server auth failed, falling back to local:",r),null}}const s=document.getElementById("registerForm"),l=document.getElementById("loginForm");s&&s.addEventListener("submit",async e=>{e.preventDefault();const t=document.getElementById("registerName").value.trim(),r=document.getElementById("registerEmail").value.trim(),a=document.getElementById("registerPassword").value;if(await u("/api/auth/register",{name:t,email:r,password:a})){alert("Registered (server)"),window.location.href="/index.html";return}const n=m();if(n.find(o=>o.email===r)){alert("Email already registered (local)");return}n.push({name:t,email:r,password:a}),I(n),alert("Registered (local fallback). You can login now."),window.location.href="/auth/login.html"});l&&l.addEventListener("submit",async e=>{e.preventDefault();const t=document.getElementById("loginEmail").value.trim(),r=document.getElementById("loginPassword").value,a=await u("/api/auth/login",{email:t,password:r});if(a&&a.token){localStorage.setItem("token",a.token),alert("Logged in (server)"),window.location.href="/index.html";return}const n=m().find(o=>o.email===t&&o.password===r);if(!n){alert("Login failed (local)");return}localStorage.setItem("local_user",JSON.stringify({name:n.name,email:n.email})),alert("Logged in (local)"),window.location.href="/index.html"});export{B as a,b as l,L as o,A as r};

import{initializeApp as f}from"https://www.gstatic.com/firebasejs/10.14.0/firebase-app.js";import{getAuth as h,onAuthStateChanged as c,signInWithEmailAndPassword as w,createUserWithEmailAndPassword as p}from"https://www.gstatic.com/firebasejs/10.14.0/firebase-auth.js";const y={apiKey:"AIzaSyB92OXlJn50jta9IHuY5czC937HMgYH2xs",authDomain:"historytimeline-wdd330.firebaseapp.com",projectId:"historytimeline-wdd330",storageBucket:"historytimeline-wdd330.firebasestorage.app",messagingSenderId:"539673015003",appId:"1:539673015003:web:2621f434393950b78312fe",measurementId:"G-GV6LHVLN1R"},I=f(y),s=h(I);async function U(r,t){const e=await w(s,r,t);return e.user?.email&&localStorage.setItem("currentUser",e.user.email),e}async function b(r,t){const e=await p(s,r,t);return e.user?.email&&localStorage.setItem("currentUser",e.user.email),e}function B(r){c(s,t=>{t?.email?localStorage.setItem("currentUser",t.email):localStorage.removeItem("currentUser"),r(t)})}function L(r="login.html"){c(s,t=>{t||(alert("Please log in to access this page."),window.location.href=r)})}function m(){return"local_users_v1"}function u(){try{return JSON.parse(localStorage.getItem(m())||"[]")}catch{return[]}}function S(r){localStorage.setItem(m(),JSON.stringify(r))}async function d(r,t){try{const e=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),a=await e.json();if(!e.ok)throw new Error(a.message||"Server error");return a}catch(e){return console.warn("Server auth failed, using local fallback:",e),null}}const i=document.getElementById("registerForm"),l=document.getElementById("loginForm");i&&i.addEventListener("submit",async r=>{r.preventDefault();const t=document.getElementById("registerName").value.trim(),e=document.getElementById("registerEmail").value.trim(),a=document.getElementById("registerPassword").value;if(await d("/api/auth/register",{name:t,email:e,password:a})){alert("Registered (server)"),window.location.href="/index.html";return}const n=u();if(n.find(o=>o.email===e)){alert("Email already registered (local)");return}n.push({name:t,email:e,password:a}),S(n),alert("Registered (local fallback). You can now log in."),window.location.href="/auth/login.html"});l&&l.addEventListener("submit",async r=>{r.preventDefault();const t=document.getElementById("loginEmail").value.trim(),e=document.getElementById("loginPassword").value,a=await d("/api/auth/login",{email:t,password:e});if(a&&a.token){localStorage.setItem("token",a.token),localStorage.setItem("currentUser",t),alert("Logged in (server)"),window.location.href="/index.html";return}const n=u().find(o=>o.email===t&&o.password===e);if(!n){alert("Login failed (local)");return}localStorage.setItem("local_user",JSON.stringify({name:n.name,email:n.email})),localStorage.setItem("currentUser",n.email),alert("Logged in (local)"),window.location.href="/index.html"});export{b as a,U as l,B as o,L as r};

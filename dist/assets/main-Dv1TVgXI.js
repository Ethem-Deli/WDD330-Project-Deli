import"./modulepreload-polyfill-B5Qt9EMX.js";import{a as L,l as B,g as y,s as E,e as S,c as k,m as C}from"./favorites-fSuJaKJR.js";import{onAuthStateChanged as M}from"https://www.gstatic.com/firebasejs/10.14.0/firebase-auth.js";import"https://www.gstatic.com/firebasejs/10.14.0/firebase-app.js";import"https://www.gstatic.com/firebasejs/10.14.0/firebase-firestore.js";function x(e,t){const n=document.getElementById("globalSearch"),o=document.getElementById("searchBtn");if(!n||!o){console.warn("üîç Search input or button not found in header.");return}const a=()=>{const r=n.value.trim().toLowerCase();if(!r){t(e);return}const c=e.filter(i=>{const s=i.title?.toLowerCase()||"",d=i.description?.toLowerCase()||"",l=i.year?.toString()||"",m=i.theme?.toLowerCase()||"";return s.includes(r)||d.includes(r)||l.includes(r)||m.includes(r)});t(c)};n.addEventListener("input",a),o.addEventListener("click",a)}function F(){const e=document.querySelectorAll(".event-card");if(!e.length)return;const t=new IntersectionObserver((n,o)=>{n.forEach(a=>{a.isIntersecting&&(a.target.classList.add("animate-in"),o.unobserve(a.target))})},{threshold:.2});e.forEach(n=>t.observe(n))}const T="https://en.wikipedia.org/w/api.php";async function b(e){const t=new URL(T);e.format="json",e.origin="*",Object.keys(e).forEach(o=>t.searchParams.append(o,e[o]));const n=await fetch(t.toString());if(!n.ok)throw new Error(`Wikipedia API error: ${n.status}`);return n.json()}async function $(e,t=10){if(!e.trim())return[];const n=await b({action:"query",list:"search",srsearch:e,srlimit:String(t),srprop:"snippet|timestamp"});return!n.query||!n.query.search?[]:n.query.search.map(o=>({id:o.pageid,title:o.title,snippet:(o.snippet||"").replace(/<\/?[^>]+(>|$)/g,"")}))}async function A(e=[]){if(!e.length)return{};const t={action:"query",pageids:e.join("|"),prop:"coordinates|pageimages|extracts",piprop:"thumbnail",pithumbsize:"600",exintro:"1",explaintext:"1"},n=await b(t),o={};if(!n.query||!n.query.pages)return o;for(const a of Object.keys(n.query.pages)){const r=n.query.pages[a];o[a]={pageid:r.pageid,title:r.title,thumbnail:r.thumbnail?r.thumbnail.source:null,extract:r.extract||"",coordinates:r.coordinates&&r.coordinates[0]?{lat:r.coordinates[0].lat,lon:r.coordinates[0].lon}:null}}return o}async function q(e){try{const t=await $(e,12);if(!t.length)return[];const n=t.map(a=>a.id),o=await A(n);return t.map(a=>{const r=String(a.id),c=o[r]||{};return{id:a.id,pageid:a.id,title:a.title,description:c.extract||a.snippet||"",image:c.thumbnail||"./src/assets/logo.png",lat:c.coordinates?c.coordinates.lat:null,lng:c.coordinates?c.coordinates.lon:null}})}catch(t){return console.error("fetchEvents error",t),[]}}function p(e,t="info"){let n=document.querySelector(".toast-container");n||(n=document.createElement("div"),n.className="toast-container",document.body.appendChild(n));const o=document.createElement("div");o.className=`toast toast-${t}`,o.textContent=e,n.appendChild(o),setTimeout(()=>o.classList.add("visible"),50),setTimeout(()=>{o.classList.remove("visible"),setTimeout(()=>o.remove(),400)},3e3)}function j(e){M(L,t=>e(t))}let u=[];async function H(e){if(!(window.google&&google.maps))return new Promise((t,n)=>{const o=document.querySelector("script[data-google-maps]");if(o){o.onload=t,o.onerror=n;return}const a=document.createElement("script");a.dataset.googleMaps="true",a.src=`https://maps.googleapis.com/maps/api/js?key=${e}&loading=async&libraries=maps,marker`,a.async=!0,a.defer=!0,a.onload=t,a.onerror=n,document.head.appendChild(a)})}async function w(e,t){const n=document.getElementById(t);if(!n)return;const o=await fetch(e);n.innerHTML=await o.text()}function v(e=[]){const t=document.getElementById("timelineList");if(t){if(!e||e.length===0){t.innerHTML='<p class="no-results">No events found for your search.</p>';return}t.innerHTML=e.map(n=>`
      <div class="event-card" data-id="${n.id}">
        <img src="${n.image}" alt="${n.title}" class="event-image">
        <div class="card-body">
          <h3>${n.title}</h3>
          <p>${n.description.slice(0,100)}...</p>
        </div>
        <button class="favorite-btn" title="Favorite">‚ù§Ô∏è</button>
      </div>
    `).join(""),F()}}function I(e=[]){const t=document.getElementById("favoritesList");t&&(t.innerHTML=`
    <div class="favorites-header">
      <h3>Your Favorites</h3>
      <div class="fav-actions">
        <button id="exportFavsBtn" class="btn-small">‚¨áÔ∏è Export</button>
        <button id="shareFavsBtn" class="btn-small">üîó Share</button>
      </div>
    </div>
    ${e.length?e.map(n=>`
              <div class="event-card small" data-id="${n.id}">
                <img src="${n.image}" alt="${n.title}" class="event-image-small">
                <div class="card-body"><h4>${n.title}</h4></div>
              </div>`).join(""):"<p>No favorites yet ‚ù§Ô∏è</p>"}
  `,document.getElementById("exportFavsBtn").onclick=S,document.getElementById("shareFavsBtn").onclick=async()=>{await k(),p("‚úÖ Share link copied to clipboard!","success")})}async function P(e){const t=await y();if(t.find(o=>o.id===e.id)){const o=t.filter(a=>a.id!==e.id);await E(o),p("Removed from favorites ‚ùå","error")}else t.push(e),await E(t),p("Added to favorites ‚ù§Ô∏è","success");I(await y())}async function g(e){const t=document.getElementById("eventModal"),n=document.getElementById("modalTitle"),o=document.getElementById("modalImage"),a=document.getElementById("modalDescription"),r=document.getElementById("modalMap"),c=document.getElementById("modalFooter");if(t){t.style.display="block",n.textContent=e.title,o.src=e.image||"./src/assets/placeholder.png",a.textContent=e.description||"No description available.",r.innerHTML="Loading map...",await H("AIzaSyDLwMRu47yXHBbfX4cimCx9BnIEtdmd0zk");try{const{Map:i}=await google.maps.importLibrary("maps"),{AdvancedMarkerElement:s}=await google.maps.importLibrary("marker"),d=e.lat,l=e.lng;if(d&&l){const m=new i(r,{zoom:5,center:{lat:d,lng:l}});new s({map:m,position:{lat:d,lng:l},title:e.title});const h=document.createElement("a");h.href=`https://www.google.com/maps?q=${d},${l}`,h.target="_blank",h.textContent="üìç View on Google Maps",r.appendChild(h)}else r.innerHTML="<p>Location not available.</p>"}catch(i){console.error("Map error:",i),r.innerHTML="<p>Map could not be loaded.</p>"}c.innerHTML=`
    <button id="shareEventBtn" class="btn-small">üîó Share this event</button>
  `,document.getElementById("shareEventBtn").onclick=()=>{const i=btoa(unescape(encodeURIComponent(JSON.stringify(e)))),s=`${location.origin}${location.pathname}?event=${i}`;navigator.clipboard.writeText(s).then(()=>{p("‚úÖ Event link copied to clipboard!","success")})}}}function R(){const e=new URLSearchParams(location.search);if(!e.has("event"))return null;try{const t=decodeURIComponent(escape(atob(e.get("event"))));return JSON.parse(t)}catch(t){return console.error("‚ùå Failed to parse shared event:",t),null}}function U(e){const t=(e.title+" "+e.description).toLowerCase();return t.includes("war")?"war":t.includes("revolution")?"revolution":t.includes("flight")||t.includes("moon")||t.includes("internet")||t.includes("industrial")?"technology":t.includes("discovery")||t.includes("exploration")?"exploration":"general"}function _(e){const t=document.getElementById("filterYear"),n=document.getElementById("filterDecade"),o=document.getElementById("filterTheme");if(!t||!n||!o)return;[...new Set(e.map(i=>i.year).filter(Boolean))].sort((i,s)=>i-s).forEach(i=>{const s=document.createElement("option");s.value=i,s.textContent=i,t.appendChild(s)}),[...new Set(e.map(i=>Math.floor(i.year/10)*10))].sort((i,s)=>i-s).forEach(i=>{const s=document.createElement("option");s.value=i,s.textContent=`${i}s`,n.appendChild(s)}),[...new Set(e.map(i=>i.theme))].forEach(i=>{const s=document.createElement("option");s.value=i,s.textContent=i.charAt(0).toUpperCase()+i.slice(1),o.appendChild(s)})}function f(){const e=document.getElementById("filterYear")?.value||"all",t=document.getElementById("filterDecade")?.value||"all",n=document.getElementById("filterTheme")?.value||"all";let o=[...u];if(e!=="all")o=o.filter(a=>a.year==e);else if(t!=="all"){const a=parseInt(t);o=o.filter(r=>r.year>=a&&r.year<a+10)}n!=="all"&&(o=o.filter(a=>a.theme===n)),v(o)}function N(e){e.forEach(t=>{t.theme||(t.theme=U(t))}),_(e),document.getElementById("filterYear").addEventListener("change",f),document.getElementById("filterDecade").addEventListener("change",f),document.getElementById("filterTheme").addEventListener("change",f)}document.addEventListener("DOMContentLoaded",async()=>{await w("./src/partials/header.html","header-placeholder"),await w("./src/partials/footer.html","footer-placeholder"),await B(),j(async e=>{e&&await C(),I(await y())});try{let e=await q("World History");e.length||(e=await(await fetch("./data/events.json")).json()),u=[...[{id:9991,title:"Moon landing",description:"Apollo 11 was the first manned Moon landing in 1969.",image:"https://upload.wikimedia.org/wikipedia/commons/9/9c/Aldrin_Apollo_11.jpg",lat:.67408,lng:23.47297,year:1969,theme:"technology"},{id:9992,title:"French Revolution",description:"A major political upheaval in France (1789‚Äì1799).",image:"https://upload.wikimedia.org/wikipedia/commons/6/6f/Prise_de_la_Bastille.jpg",lat:48.8566,lng:2.3522,year:1789,theme:"revolution"}],...e],v(u),N(u);const n=R();n&&g(n),x(u,v);const o=document.getElementById("timelineList"),a=document.getElementById("favoritesList"),r=document.getElementById("eventModal"),c=document.getElementById("closeModal");o.addEventListener("click",async i=>{const s=i.target.closest(".event-card");if(!s)return;const d=+s.dataset.id,l=u.find(m=>m.id===d);l&&(i.target.classList.contains("favorite-btn")?await P(l):g(l))}),a.addEventListener("click",i=>{const s=i.target.closest(".event-card");if(!s)return;const d=+s.dataset.id,l=u.find(m=>m.id===d);l&&g(l)}),c.addEventListener("click",()=>r.style.display="none")}catch(e){console.error("Error:",e),p("Failed to load events.","error")}});window.initMap=()=>{console.log("‚úÖ Google Maps API initialized.")};

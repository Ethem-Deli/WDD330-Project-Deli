import{getApps as s,initializeApp as d}from"https://www.gstatic.com/firebasejs/10.14.0/firebase-app.js";import{getAuth as p}from"https://www.gstatic.com/firebasejs/10.14.0/firebase-auth.js";import{getFirestore as m,doc as n,getDoc as g,setDoc as v}from"https://www.gstatic.com/firebasejs/10.14.0/firebase-firestore.js";const y={apiKey:"AIzaSyB92OXlJn50jta9IHuY5czC937HMgYH2xs",authDomain:"historytimeline-wdd330.firebaseapp.com",projectId:"historytimeline-wdd330",storageBucket:"historytimeline-wdd330.firebasestorage.app",messagingSenderId:"539673015003",appId:"1:539673015003:web:2621f434393950b78312fe",measurementId:"G-GV6LHVLN1R"},i=s().length?s()[0]:d(y),c=p(i),l=m(i),u="favorites_v1";function o(){try{return JSON.parse(localStorage.getItem(u)||"[]")}catch{return[]}}function f(e){try{localStorage.setItem(u,JSON.stringify(e||[]))}catch(t){console.error("Failed saving local favorites:",t)}}async function h(){try{const e=c.currentUser;if(!e)return null;const t=n(l,"favorites",e.uid),r=await g(t);return r.exists()?r.data().items||[]:[]}catch(e){return console.warn("firebaseGetFavorites failed:",e),null}}async function b(e){try{const t=c.currentUser;if(!t)return!1;const r=n(l,"favorites",t.uid);return await v(r,{items:e},{merge:!0}),!0}catch(t){return console.warn("firebaseSaveFavorites failed:",t),!1}}async function L(){const e=await h();return Array.isArray(e)?e:o()}async function U(e){await b(e)||f(e)}function I(){const e=o(),t=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),r=URL.createObjectURL(t),a=document.createElement("a");a.href=r,a.download="favorites.json",a.click(),URL.revokeObjectURL(r)}async function A(){const e=o(),t=btoa(unescape(encodeURIComponent(JSON.stringify(e)))),r=`${location.origin}${location.pathname}?shared=${t}`;return await navigator.clipboard.writeText(r),r}function O(){const e=new URLSearchParams(location.search);if(!e.has("shared"))return!1;try{const t=decodeURIComponent(escape(atob(e.get("shared")))),r=JSON.parse(t);return f(r),!0}catch(t){return console.error("loadSharedFavoritesFromQuery failed:",t),!1}}export{A as c,I as e,L as g,O as l,U as s};
